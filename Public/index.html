<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/addons/p5.dom.min.js"></script>
    <title>Document</title>
  </head>
  <body>
    <h2>Hello ...!</h2>
    <div>
      <p><a href="index.html">enter</a> || <a href="list.html">list</a></p>
      <h3>Coordinates</h3>
      <p id="latitude"></p>
      <p id="longitude"></p>
    </div>
    <button type="submit" id="submit">SUBMIT</button>
  </body>
  <script>
    function setup() {
      noCanvas();
      const video = createCapture(VIDEO);
      video.size(320, 240);

      let coords;
      if ("geolocation" in navigator) {
        console.log("geolocation  available...");
        navigator.geolocation.getCurrentPosition((position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          document.getElementById("latitude").textContent = "Latitude : " + lat;
          document.getElementById("longitude").textContent =
            "Longitude : " + lon;

          coords = { lat, lon };
        });
      } else {
        console.log("geolocation not available...");
      }

      document.getElementById("submit").addEventListener("click", () => {
        video.loadPixels();
        const image64 = video.canvas.toDataURL();
        let data = { coords, image64 };
        fetch("/api", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((resp) => resp.json())
          .then((data) => console.log(data));
      });
    }
  </script>
</html>
